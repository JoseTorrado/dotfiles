#!/bin/bash

# Default behavior: exit at 5pm
IGNORE_TIME_LIMIT=false

# Function to display usage
usage() {
  echo "Usage: $0 [OPTIONS]"
  echo "Options:"
  echo "  -i, --ignore-time    Ignore the 5pm time limit and run indefinitely"
  echo "  -h, --help           Display this help message"
  exit 1
}

# Parse command line arguments
while [[ $# -gt 0 ]]; do
  case $1 in
  -i | --ignore-time)
    IGNORE_TIME_LIMIT=true
    shift
    ;;
  -h | --help)
    usage
    ;;
  *)
    echo "Unknown option: $1"
    usage
    ;;
  esac
done

# Function to simulate key press using AppleScript
simulate_key_press() {
  osascript -e 'tell application "System Events" to key code 96 using shift down'
  # Key code 96 corresponds to F15 on Mac
}

# Main loop
while true; do
  # Only check time if we're not ignoring the time limit
  if [ "$IGNORE_TIME_LIMIT" = false ]; then
    # Get current hour in 24-hour format
    current_hour=$(date +%H)

    # Check if it's 5pm or later (17:00 or later in 24-hour format)
    if [ "$current_hour" -ge 17 ]; then
      echo "It's 5pm or later, exiting program..."
      exit 0
    fi
  fi

  simulate_key_press
  sleep 59
done
